---
layout: post
title: Multiple Database CodeIgniter
categories:
- CodeIgniter
tags: []
status: publish
type: post
published: true
description: Working with More than One Database with CodeIgniter
meta:
  _wpas_skip_twitter: '1'
---
Well, one of my favorite things of <a href="http://codeigniter.com/" target="_blank">CodeIgniter</a> is the possibility of can use multi database connections, and how it is?
well first if you work with the 2.0.2 version of CodeIgniter you need to fix some bug in the <strong><em>DB_driver.php</em></strong> that you can find in the database folder on the framework and you need to find the simple query function (function simple_query($sql)), so this will be the original function

{% highlight php %}
function simple_query($sql)
	{
		if ( ! $this->conn_id)
		{
			$this->initialize();
		}
		return $this->_execute($sql);
	}
{% endhighlight %}

and just only need to add this line

{% highlight php %}
$this->db_select();
{% endhighlight %}

where? well before of the return like this

{% highlight php %}
function simple_query($sql)
	{
		if ( ! $this->conn_id)
		{
			$this->initialize();
		}
		 $this->db_select();  //----this line
                 return $this->_execute($sql);
	}
{% endhighlight %}

and then you can follow the instructions at the codeigniter <a href="http://codeigniter.com/user_guide/database/connecting.html" target="_blank">user_guide</a>, anyway i will be post the other steps, so when you finish or fix the bug you need to go to your <em><strong>dababase.php</strong></em> config and add another active group or other string conexion like this

{% highlight php %}
// original and default conexion
$active_group = "default";
$active_record = TRUE;

$db['default']['hostname'] = "hotname";
$db['default']['username'] = "username";
$db['default']['password'] = "pass";
$db['default']['database'] = "database1";
$db['default']['dbdriver'] = "mssql";
$db['default']['dbprefix'] = "";
$db['default']['pconnect'] = FALSE;
$db['default']['db_debug'] = TRUE;
$db['default']['cache_on'] = FALSE;
$db['default']['cachedir'] = "";
$db['default']['char_set'] = "utf8";
$db['default']['dbcollat'] = "utf8_general_ci";

 // other database
$active_group = "db2";
$active_record = TRUE;

$db['db2']['hostname'] = "hostname";
$db['db2']['username'] = "username";
$db['db2']['password'] = "pass";
$db['db2']['database'] = "database2";
$db['db2']['dbdriver'] = "mssql";
$db['db2']['dbprefix'] = "";
$db['db2']['pconnect'] = FALSE;
$db['db2']['db_debug'] = TRUE;
$db['db2']['cache_on'] = FALSE;
$db['db2']['cachedir'] = "";
$db['db2']['char_set'] = "utf8";
$db['db2']['dbcollat'] = "utf8_general_ci";
{% endhighlight %}

and you can add another strings if you want, so has you see you can connect to other server if you want too, so if you used more of one database connection you need to remove in the array libraries <em><strong>autoload.php</strong></em> the database library.
So when you need to call some string of connection in your model only need something like this

{% highlight php %}
// results query database 1
$this->default_db = $this->load->database('default', true);
   $q = $this->default_db->query('select * from table');

// results query database 2
$this->db2_db = $this->load->database('db2', true);
   $q = $this->db2_db->query('select * from table');
{% endhighlight %}

and that's it, obviously there are other and many ways to do but this is a very simple way.
